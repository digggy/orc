module openwrt-network {
  namespace "urn:jacobs:yang:openwrt-network";
  prefix "on";

  import ietf-inet-types {
    prefix inet;
  }

  import ietf-yang-types {
    prefix yang;
  }

  import openwrt-uci-extension {
    prefix uci;
  }

  contact "Malte Granderath <m.granderath@jacobs-university.de>";
  revision 2019-04-24 {
    description "initial revision";
  }

  typedef openwrt-bool {
    type string {
      pattern "(0|1)";
    }
  }

  uci:uci-package "network";
  container globals {
    uci:uci-section-type "globals";
    uci:uci-section "globals";

    leaf ula_prefix {
      uci:uci-option "ula_prefix";
      type inet:ipv6-prefix;
      description "IPv6 prefix for device";
    }
  }

  container interfaces {
    uci:uci-section-type "interfaces";
    uci:uci-section "interfaces";

    list interface {
      uci:uci-section-type "interface";
      key "ifname";

      leaf ifname {
        uci:uci-option "ifname";
        type string;
        mandatory true;
        description "Physical interface name";
      }

      leaf iftype {
        uci:uci-option "type";
        type string;
        description "Type of interface";
      }

      leaf stp {
        uci:uci-option "stp";
        type openwrt-bool;
        description "Enable spanning tree protocol";
      }

      leaf bridge_empty {
        uci:uci-option "bridge_empty";
        type openwrt-bool;
        description "Enable creating empty bridge";
      }

      leaf igmp_snooping {
        uci:uci-option "imgp_snooping";
        type openwrt-bool;
        description "Enable multicast_snooping";
      }

      leaf multicast_querier {
        uci:uci-option "multicast_querier";
        type openwrt-bool;
        description "Enable mutlicast_queries";
      }

      leaf macaddr {
        uci:uci-option "macaddr";
        type yang:phys-address;
        description "Override the MAC address of the interface";
      }

      leaf mtu {
        uci:uci-option "mtu";
        type int64;
        description "Override the default MTU of the interface";
      }

      leaf auto {
        uci:uci-option "auto";
        type openwrt-bool;
        description "Bring up interface at boot";
      }

      leaf ipv6 {
        uci:uci-option "ipv6";
        type openwrt-bool;
        description "Enable or disable IPv6";
      }

      leaf force_link {
        uci:uci-option "force_link";
        type openwrt-bool;
        description
          "Specifies whether ip address, route, and optionally gateway are assigned to the interface
        regardless of the link being active ('1') or only after the link has become active ('0');";
      }

      leaf disabled {
        uci:uci-option "disabled";
        type openwrt-bool;
        description "Enable or disable the interface";
      }

      leaf ip4table {
        uci:uci-option "ip4table";
        type string;
        description "IPv4 routing table for this interface";
      }

      leaf ip6table {
        uci:uci-option "ip6table";
        type string;
        description "IPv6 routing table for this interface";
      }

      leaf proto {
        uci:uci-option "proto";
        type string;
        description "The protocol of the interface";
      }

      leaf ipaddr {
        uci:uci-option "ipaddr";
        type inet:ipv4-address;
        description "Alias IP address";
      }

      leaf netmask {
        uci:uci-option "netmask";
        type inet:ipv4-prefix;
        description "Alias Netmask";
      }

      leaf gateway {
        uci:uci-option "gateway";
        type inet:ipv4-address;
        description "Default gateway";
      }

      leaf broadcast {
        uci:uci-option "broadcast";
        type inet:ipv4-address;
        description "Broadcast address (autogenerated if not setup)";
      }

      leaf ip6addr {
        uci:uci-option "ip6addr";
        type inet:ipv6-address;
        description "IPv6 address";
      }

      leaf ip6gw {
        uci:uci-option "ip6gw";
        type inet:ipv6-address;
        description "IPv6 default gateway";
      }

      leaf-list dns {
        uci:uci-option "dns";
        type inet:ipv4-address;
        description "list of dns servers";
      }

      leaf layer {
        uci:uci-option "layer";
        type uint8 {
          range "1..3";
        }
        description "Selects the interface to attach to for stacked protocols";
      }
    }
  }

  container rules {
    uci:uci-section-type "rules";
    uci:uci-section "rules";

    list ip4rules {
      uci:uci-section-type "rule";
      key "mark";

      leaf mark {
        uci:uci-option "mark";
        type string;
        description "Specifies the fwmark";
      }

      leaf in {
        uci:uci-option "in";
        type string;
        description "Specifies the incoming logical interface name";
      }

      leaf out {
        uci:uci-option "out";
        type string;
        description "Specifies the outgoing logical interface name";
      }

      leaf src {
        uci:uci-option "src";
        type inet:ipv4-prefix;
        description "Specifies the source subnet to match";
      }

      leaf dest {
        uci:uci-option "dest";
        type inet:ipv4-prefix;
        description "Specifies the destination subnet to match";
      }

      leaf tos {
        uci:uci-option "tos";
        type uint64;
        description "Specifies the TOS value to match in the IP headers";
      }

      leaf invert {
        uci:uci-option "invert";
        type openwrt-bool;
        description "Inverts the meaning of match options";
      }

      leaf priority {
        uci:uci-option "priority";
        type uint64;
        description "Declares the priority of the rule";
      }

      leaf lookup {
        uci:uci-option "lookup";
        type string;
        description "The rule lookup target";
      }

      leaf goto {
        uci:uci-option "goto";
        type uint64;
        description "The rule target is another rule with priority";
      }

      leaf action {
        uci:uci-option "action";
        type string;
      }
    }

    list ip6rules {
      uci:uci-section-type "rule";
      key "mark";

      leaf mark {
        uci:uci-option "mark";
        type string;
        description "Specifies the fwmark";
      }

      leaf in {
        uci:uci-option "in";
        type string;
        description "Specifies the incoming logical interface name";
      }

      leaf out {
        uci:uci-option "out";
        type string;
        description "Specifies the outgoing logical interface name";
      }

      leaf src {
        uci:uci-option "src";
        type inet:ipv6-prefix;
        description "Specifies the source subnet to match";
      }

      leaf dest {
        uci:uci-option "dest";
        type inet:ipv6-prefix;
        description "Specifies the destination subnet to match";
      }

      leaf tos {
        uci:uci-option "tos";
        type uint64;
        description "Specifies the TOS value to match in the IP headers";
      }

      leaf invert {
        uci:uci-option "invert";
        type openwrt-bool;
        description "Inverts the meaning of match options";
      }

      leaf priority {
        uci:uci-option "priority";
        type uint64;
        description "Declares the priority of the rule";
      }

      leaf lookup {
        uci:uci-option "lookup";
        type string;
        description "The rule lookup target";
      }

      leaf goto {
        uci:uci-option "goto";
        type uint64;
        description "The rule target is another rule with priority";
      }

      leaf action {
        uci:uci-option "action";
        type string;
      }
    }
  }

  container routes {
    uci:uci-section-type "routes";
    uci:uci-section "routes";

    list ip4routes {
      uci:uci-section-type "route";
      key "name";

      leaf name {
        uci:uci-option "name";
        type string;
        description "Name of rule";
      }

      leaf interface {
        uci:uci-option "interface";
        type string;
        mandatory true;
        description "Specifies the interface name this route belongs to";
      }

      leaf target {
        uci:uci-option "target";
        type inet:ipv4-address;
        description "The target network address";
      }

      leaf netmask {
        uci:uci-option "netmask";
        type inet:ipv4-prefix;
        description "The route netmask";
      }

      leaf gateway {
        uci:uci-option "gateway";
        type inet:ipv4-address;
        description "The network gateway";
      }

      leaf metric {
        uci:uci-option "metric";
        type uint64;
        description "Specifies the route metric to use";
      }

      leaf mtu {
        uci:uci-option "mtu";
        type uint64;
        description "Specifies a MTU for this route";
      }

      leaf table {
        uci:uci-option "table";
        type string;
        description "Specifies the table id to use for route";
      }

      leaf source {
        uci:uci-option "source";
        type inet:ipv4-address;
        description "The preferred source address when sending to destinations";
      }

      leaf onlink {
        uci:uci-option "onlink";
        type openwrt-bool;
        description "Enable gateway on link, even if gateway does not match any interface prefix";
      }

      leaf rtype {
        uci:uci-option "type";
        type string;
      }
    }

    list ip6routes {
      uci:uci-section-type "route6";
      key "name";

      leaf name {
        uci:uci-option "name";
        type string;
        description "Name of rule";
      }

      leaf interface {
        uci:uci-option "interface";
        type string;
        mandatory true;
        description "Specifies the interface name this route belongs to";
      }

      leaf target {
        uci:uci-option "target";
        type inet:ipv6-address;
        description "The target network address";
      }

      leaf gateway {
        uci:uci-option "gateway";
        type inet:ipv6-address;
        description "The network gateway";
      }

      leaf metric {
        uci:uci-option "metric";
        type uint64;
        description "Specifies the route metric to use";
      }

      leaf mtu {
        uci:uci-option "mtu";
        type uint64;
        description "Specifies a MTU for this route";
      }

      leaf table {
        uci:uci-option "table";
        type string;
        description "Specifies the table id to use for route";
      }

      leaf source {
        uci:uci-option "source";
        type inet:ipv4-address;
        description "The preferred source address when sending to destinations";
      }

      leaf onlink {
        uci:uci-option "onlink";
        type openwrt-bool;
        description "Enable gateway on link, even if gateway does not match any interface prefix";
      }

      leaf rtype {
        uci:uci-option "type";
        type string;
      }
    }
  }

  container switches {
    uci:uci-section-type "switches";
    uci:uci-section "switches";

    list switch {
      uci:uci-section-type "switch";
      key "name";

      leaf name {
        uci:uci-option "name";
        type string;
        description "The name of the switch to configure";
      }

      leaf reset {
        uci:uci-option "reset";
        type openwrt-bool;
      }

      leaf enable_vlan {
        uci:uci-option "enable_vlan";
        type openwrt-bool;
      }

      leaf enable_mirror_rx {
        uci:uci-option "enable_mirror_rx";
        type openwrt-bool;
        description "Mirror received packets from the mirror_source_port to the mirror_monitor_port";
      }

      leaf enable_mirror_tx {
        uci:uci-option "enable_mirror_tx";
        type openwrt-bool;
        description "Mirror transmitted packets from the mirror_source_port to the  mirror_monitor_port";
      }

      leaf mirror_monitor_port {
        uci:uci-option "mirror_monitor_port";
        type uint64;
        description "Switch port to which the packets are mirrored";
      }

      leaf mirror_source_port {
        uci:uci-option "mirror_source_port";
        type uint64;
        description "Switch port from which packets are mirrored";
      }

      leaf arl_age_time {
        uci:uci-option "arl_age_time";
        type uint64;
        description "Adjust the address resolution table's aging time";
      }

      leaf igmp_snooping {
        uci:uci-option "igmp_snooping";
        type openwrt-bool;
      }

      leaf igmp_v3 {
        uci:uci-option "igmp_v3";
        type openwrt-bool;
      }
    }

    list switch_vlan {
      uci:uci-section-type "switch_vlan";
      key "device vlan";

      leaf device {
        uci:uci-option "device";
        type string;
        description "The device to configure";
      }

      leaf vlan {
        uci:uci-option "vlan";
        type uint64;
        description "The VLAN table index to configure";
      }

      leaf vid {
        uci:uci-option "vid";
        type uint64;
        description "The VLAN tag number to use";
      }

      leaf-list ports {
        uci:uci-option "ports";
        type string;
        description "List of port indices that should be associated with VLAN";
      }
    }

    list switch_port {
      uci:uci-section-type "switch_port";
      key "device port";

      leaf device {
        uci:uci-option "device";
        type string;
        description "The device to configure";
      }

      leaf port {
        uci:uci-option "port";
        type uint64;
        description "The port index to configure";
      }

      leaf pvid {
        uci:uci-option "pvid";
        type uint64;
        description "The port PVID";
      }

      leaf enable_eee {
        uci:uci-option "enable_eee";
        type openwrt-bool;
        description "Enable power-saving features";
      }

      leaf igmp_snooping {
        uci:uci-option "igmp_snooping";
        type openwrt-bool;
      }

      leaf igmp_v3 {
        uci:uci-option "igmp_v3";
        type openwrt-bool;
      }
    }
  }
}