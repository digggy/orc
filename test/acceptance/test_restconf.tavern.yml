---

test_name: setting up

includes:
  - !include common.yaml

stages:
  - name: delete current configuration
    request:
      url: "{url}/data/restconf-example:course"
      method: DELETE
      headers:
        content-type: application/yang-data+json
        accept: application/yang-data+json
    response:
      status_code:
        - 204
        - 404

  - name: check empty state
    request:
      url: "{url}/data/restconf-example:course"
      method: GET
      headers:
        content-type: application/yang-data+json
        accept: application/yang-data+json
    response:
      status_code: 404
      json:
        ietf-restconf:errors:
          error:
            - error-tag: "invalid-value"
              error-type: "protocol"

---

test_name: check POST root
includes:
  - !include common.yaml

stages:
  - name: check malformed
    request:
      url: "{url}/data/"
      method: POST
      headers:
        content-type: application/yang-data+json
        accept: application/yang-data+json
      json:
        restconf-example:course:
          this does not exist: 5
    response:
      status_code: 404

  - name: check empty state
    request:
      url: "{url}/data/restconf-example:course"
      method: GET
      headers:
        content-type: application/yang-data+json
        accept: application/yang-data+json
    response:
      status_code: 404
      json:
        ietf-restconf:errors:
          error:
            - error-tag: "invalid-value"
              error-type: "protocol"
  - name: post valid content
    request:
      url: "{url}/data/"
      method: POST
      headers:
        content-type: application/yang-data+json
        accept: application/yang-data+json
      json:
        !include POST/root-valid.yaml
    response:
      status_code: 201
      headers:
        location: "{url}/data/restconf-example:course"
        transfer-encoding: chunked

  - name: check valid content exists
    request:
      url: "{url}/data/restconf-example:course"
      method: GET
      headers:
        content-type: application/yang-data+json
        accept: application/yang-data+json
    response:
      status_code: 200
      json:
        !include GET/root-valid.yaml
