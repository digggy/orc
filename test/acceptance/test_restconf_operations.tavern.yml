---

test_name: Get operations and initializations

includes:
  - !include common.yaml

stages:
  - name: Get all operations
    request:
      url: "{url}/operations/"
      method: GET
      headers:
        content-type: application/yang-data+json
        accept: application/yang-data+json
    response:
      status_code:
        - 200
      json:
        'openwrt-restconf:operations':
          'openwrt-operations:copy': '/restconf/operations/openwrt-operations:copy'
          'openwrt-operations:delete': '/restconf/operations/openwrt-operations:delete'
          'openwrt-operations:reboot': '/restconf/operations/openwrt-operations:reboot'
          'openwrt-operations:ping': '/restconf/operations/openwrt-operations:ping'
          'openwrt-operations:mtr': '/restconf/operations/openwrt-operations:mtr'
          'openwrt-operations:opkg': '/restconf/operations/openwrt-operations:opkg'

---

test_name: POST test on mtr

strict:
  - headers:off
  - json:off

includes:
  - !include common.yaml

stages:
  - name: POST test on mtr
    request:
      url: "{url}/operations/openwrt-operations:mtr"
      method: POST
      headers:
        content-type: application/yang-data+json
        accept: application/yang-data+json
      json:
        !include POST/OPERATIONS/valid-mtr.yaml
    response:
      verify_response_with:
        function: tavern.testutils.helpers:validate_pykwalify
        extra_kwargs:
          schema:
            map:
              report:
                type: map
                mapping:
                  mtr:
                    type: map
                    mapping:
                      source:
                        type: str 
                      destination: 
                        type: str                  
                      type-of-service: 
                        type: str                  
                      packet-size: 
                        type: str                  
                      bitpattern:
                        type: str 
                      tests:                                  
                        type: str
                  hubs:
                    type: seq
                    sequence:
                      - type: map
                        mapping:
                          count: 
                            type: str
                          host: 
                            type: str
                          loss-percent:
                            type: float
                          sent:
                            type: int
                          last: 
                            type: float
                          average-rtt: 
                            type: float
                          best-rtt: 
                            type: float
                          worst-rtt: 
                            type: float
                          standard-deviation:
                            type: float




# ---

# test_name: Check for methods allowed on endpoints

# strict:
#   - headers:off
#   - json:off

# includes:
#   - !include common.yaml

# stages:
#   - name: POST on operations root
#     request:
#       url: "{url}/operations/"
#       method: POST
#       headers:
#         content-type: application/yang-data+json
#         accept: application/yang-data+json
#     response:
#       status_code:
#         - 405
  
#   - name: OPTIONS on operations root
#     request:
#       url: "{url}/operations/"
#       method: OPTIONS
#       headers:
#         content-type: application/yang-data+json
#         accept: application/yang-data+json
#     response:
#       headers:
#         allow: OPTIONS, GET, HEAD
#       status_code:
#         - 200

#   - name: OPTIONS on data/ endpoints
#     request:
#       url: "{url}/data/restconf-example:course"
#       method: OPTIONS
#       headers:
#         content-type: application/yang-data+json
#         accept: application/yang-data+json
#     response:
#       headers:
#         allow: DELETE, GET, HEAD, PATCH, POST, PUT, OPTIONS
#       status_code:
#         - 200

#   - name: "OPTIONS on /operations/openwrt-operations:mtr endpoints"
#     request:
#       url: "{url}/operations/openwrt-operations:mtr"
#       method: OPTIONS
#       headers:
#         content-type: application/yang-data+json
#         accept: application/yang-data+json
#     response:
#       headers:
#         allow: OPTIONS, POST
#       status_code:
#         - 200

#   - name: "OPTIONS on /operations/openwrt-operations:ping endpoints"
#     request:
#       url: "{url}/operations/openwrt-operations:ping"
#       method: OPTIONS
#       headers:
#         content-type: application/yang-data+json
#         accept: application/yang-data+json
#     response:
#       headers:
#         allow: OPTIONS, POST
#       status_code:
#         - 200
  